@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix prez: <https://prez.dev/> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

prez:skosWeighted a prez:SearchMethod ;
                        dcterms:identifier "skosWeighted" ;
    rdfs:label "SKOS Weighted Search"@en ;
    rdf:value """
    PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
    PREFIX prez: <https://prez.dev/>

    CONSTRUCT {{ ?uri skos:prefLabel ?pl ;
                      prez:searchResultWeight ?weight ;
                      prez:searchResultSource prez:$PREZ ;
                      prez:usingSearchMethod prez:skosWeighted .
    }}
    {{
        SELECT DISTINCT ?g ?uri ?pl (SUM(?w) AS ?weight)
        WHERE {{
            GRAPH ?g {{
                        {{  # exact match on a prefLabel always wins
                            ?uri a skos:Concept ;
                                 skos:prefLabel ?pl .
                            BIND (50 AS ?w)
                            FILTER REGEX(?pl, "^$TERM$$", "i")
                        }}
                        UNION
                        {{
                            ?uri a skos:Concept ;
                                 skos:prefLabel ?pl .
                            BIND (10 AS ?w)
                            FILTER REGEX(?pl, "$TERM", "i")
                        }}
                        UNION
                        {{
                            ?uri a skos:Concept ;
                                 skos:altLabel ?al ;
                                 skos:prefLabel ?pl .
                            BIND (5 AS ?w)
                            FILTER REGEX(?al, "$TERM", "i")
                        }}
                        UNION
                        {{
                            ?uri a skos:Concept ;
                                 skos:hiddenLabel ?hl ;
                                 skos:prefLabel ?pl .
                            BIND (5 AS ?w)
                            FILTER REGEX(?hl, "$TERM", "i")
                        }}
                        UNION
                        {{
                            ?uri a skos:Concept ;
                                 skos:definition ?d ;
                                 skos:prefLabel ?pl .
                            BIND (1 AS ?w)
                            FILTER REGEX(?d, "$TERM", "i")
                        }}
                    }}
                }}
        GROUP BY ?g ?uri ?pl
    }}
    """ .
