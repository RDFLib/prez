PREFIX dcat: <http://www.w3.org/ns/dcat#>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX endpoint: <https://prez.dev/endpoint/extended-ogc-records/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX prez: <https://prez.dev/>
PREFIX ont: <https://prez.dev/ont/>
PREFIX sh: <http://www.w3.org/ns/shacl#>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX shext: <http://example.com/shacl-extension#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>


endpoint:top-level-catalog-listing a ont:ListingEndpoint ;
    ont:endpointTemplate "/catalogs" ;
    sh:targetClass dcat:Catalog ;  # required for query construction
    sh:target [ sh:select """
    SELECT ?focus_node
    WHERE {
        ?focus_node a <http://www.w3.org/ns/dcat#Catalog> ;
            <http://purl.org/dc/terms/hasPart> ?child .
            ?child a ?child_class .
        VALUES ?child_class { <http://www.w3.org/ns/dcat#Catalog> <http://www.w3.org/2004/02/skos/core#ConceptScheme>
        <http://www.w3.org/2004/02/skos/core#Collection> <http://www.opengis.net/ont/geosparql#FeatureCollection> }
        }
    """ ] ;
    shext:limit 20 ;
    shext:offset 0 ;
.

endpoint:top-level-catalog-object a ont:ObjectEndpoint ;
    sh:targetNode "$object" ;
    sh:targetClass dcat:Catalog ;  # endpoint CAN render objects of this class.
    ont:endpointTemplate "/catalogs/$object" ;
    ont:parentEndpoint endpoint:top-level-catalog-listing ;
.

endpoint:lower-level-catalog-listing a ont:ListingEndpoint ;
    ont:endpointTemplate "/catalogs/$parent_1/collections" ;
    ont:deliversClasses prez:CatalogList ;  # required to determine the correct profile for ConnegP
    ont:parentToFocusRelation dcterms:hasPart ;
    sh:targetClass dcat:Catalog ;  # required for query construction
    ont:parentEndpoint endpoint:top-level-catalog-object ;
    shext:limit 20 ;
    shext:offset 0 ;
    sh:target [
      sh:select """SELECT ?focus_node
         WHERE {
          $parent_1 dcterms:hasPart ?focus_node .
            }
         """ ] ;
.

endpoint:lower-level-catalog-object a ont:ObjectEndpoint ;
    sh:targetNode "$object" ;
    ont:deliversClasses dcat:Catalog ;  # required for link generation for objects
    ont:endpointTemplate "/catalogs/$parent_1/collections/$object" ;
    ont:endpointRelation [
        sh:path dcterms:hasPart
                         ];
.

endpoint:resource-listing a ont:ListingEndpoint ;
    ont:endpointTemplate "/catalogs/$parent_2/collections/$parent_1/items" ;
    ont:deliversClasses prez:ResourceList ;  # required to determine the correct profile for ConnegP
    ont:parentToFocusRelation dcterms:hasPart ;
    sh:targetClass dcat:Resource ;  # required for query construction
    ont:parentEndpoint endpoint:lower-level-catalog-object ;
    shext:limit 20 ;
    shext:offset 0 ;
    sh:target [
      sh:select """SELECT ?focus_node
         WHERE {
          $parent_1 dcterms:hasPart ?focus_node .
            }
         """ ] ;
.

endpoint:resource-object a ont:ObjectEndpoint ;
    sh:targetNode "$object" ;
    ont:deliversClasses dcat:Resource ;  # required for link generation for objects
    ont:endpointTemplate "/catalogs/$parent_2/collections/$parent_1/items/$object" ;
    ont:parentToFocusRelation dcterms:hasPart ;
    ont:parentEndpoint endpoint:resource-listing ;
.

